# 时间序列引擎

`ts_engine` 部分定义了 Datalayers 中时间序列引擎的配置设置。这些设置控制引擎如何处理数据存储、写入和刷新操作，重点是管理写前日志（WAL）组件，以确保可靠性和性能。

## 配置工作线程通道

- **`worker_channel_size`**:  
  该设置指定了时间序列引擎中每个工作线程的请求通道大小。较大的通道大小允许更多的请求在处理之前被排队，这有助于在高负载下优化性能。  
  - **默认值**：`128`。

## 配置退出时刷新 Memtable

- **`flush_on_exit`**:  
  该设置控制时间序列引擎在系统或工作线程退出时是否将内存中的数据结构（memtables）刷新到持久存储中。  
  - `true`：在退出时将 memtable 内容刷新到持久存储中，以确保不会丢失数据。  
  - `false`：退出时不进行刷新，这可能导致潜在的数据丢失。  
  - **默认值**：`true`。

## 写前日志（WAL）

`ts_engine.wal` 部分处理 WAL 组件的配置，该组件通过记录变更来确保数据持久性，然后将变更应用到数据存储中。

### 配置 WAL 类型

- **`type`**:  
  指定时间序列引擎使用的 WAL 类型。目前仅支持 "local" WAL，该类型将日志文件本地存储在服务器上。  
  - **默认值**：`"local"`。

### 控制 WAL 操作

- **`disable`**:  
  控制是否启用 WAL。禁用 WAL 将跳过写入日志和系统重启时的日志重放。  
  - `true`：禁用 WAL，意味着不会记录或重放变更。这可能导致潜在的数据丢失，仅推荐用于非关键环境。  
  - `false`：启用 WAL，通过记录和重放变更来确保数据一致性。  
  - **默认值**：`false`。

- **`skip_replay`**:  
  决定在系统启动时是否跳过 WAL 重放过程。  
  - `true`：跳过 WAL 重放，仅推荐用于开发环境。  
  - `false`：执行 WAL 重放，将系统恢复到最后一致的状态。  
  - **默认值**：`false`。

### 配置 WAL 存储

- **`path`**:  
  定义 WAL 文件存储的目录。  
  - **默认值**：`"/var/lib/datalayers/wal"`。

### WAL 刷新和文件管理

- **`flush_interval`**:  
  指定将缓存的 WAL 条目刷新到持久存储的固定时间间隔。  
  - `0`：每次写操作后立即刷新。  
  - **默认值**：`"0s"`。此设置仅适用于使用 "local" WAL 类型时。

- **`max_file_size`**:  
  限制单个 WAL 文件的大小。当文件超过此大小时，将创建新的 WAL 文件。  
  - **默认值**：`64MB`。此设置仅在 WAL 类型为 "local" 时使用。
